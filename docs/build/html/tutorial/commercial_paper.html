

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Commercial paper tutorial &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Building Your First Network" href="../build_network.html" />
    <link rel="prev" title="Writing Your First Application" href="../write_first_app.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s new in v1.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developapps/developing_applications.html">Developing Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../write_first_app.html">Writing Your First Application</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Commercial paper tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-samples">Download samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-network">Create network</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-as-magnetocorp">Working as MagnetoCorp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#smart-contract">Smart contract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-contract">Install contract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instantiate-contract">Instantiate contract</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-structure">Application structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#application-dependencies">Application dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wallet">Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issue-application">Issue application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-as-digibank">Working as DigiBank</a></li>
<li class="toctree-l3"><a class="reference internal" href="#digibank-applications">Digibank applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-as-digibank">Run as DigiBank</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buy-application">Buy application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redeem-application">Redeem application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../build_network.html">Building Your First Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../channel_update_tutorial.html">Adding an Org to a Channel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading_your_network_tutorial.html">Upgrading Your Network Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../private_data_tutorial.html">Using Private Data in Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chaincode.html">Chaincode Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chaincode4ade.html">Chaincode for Developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chaincode4noah.html">Chaincode for Operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../systemchaincode.html">System Chaincode Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../couchdb_tutorial.html">Using CouchDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../videos.html">Videos</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Commercial paper tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/commercial_paper.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="commercial-paper-tutorial">
<h1>Commercial paper tutorial<a class="headerlink" href="#commercial-paper-tutorial" title="Permalink to this headline">¶</a></h1>
<p><strong>Audience:</strong> Architects, application and smart contract developers,
administrators</p>
<p>This tutorial will show you how to install and use a commercial paper sample
application and smart contract. It is a task-oriented topic, so it emphasizes
procedures above concepts. When you’d like to understand the concepts in more
detail, you can read the
<a class="reference external" href="../developapps/developing_applications.html">Developing Applications</a> topic.</p>
<p><img alt="../_images/commercial_paper.diagram.1.png" src="../_images/commercial_paper.diagram.1.png" />commercialpaper.tutorial <em>In this tutorial
two organizations, MagnetoCorp and DigiBank, trade commercial paper with each
other using PaperNet, a Hyperledger Fabric blockchain network.</em></p>
<p>Once you’ve set up a basic network, you’ll act as Isabella, an employee of
MagnetoCorp, who will issue a commercial paper on its behalf. You’ll then switch
hats to take the role of Balaji, an employee of DigiBank, who will buy this
commercial paper, hold it for a period of time, and then redeem it with
MagnetoCorp for a small profit.</p>
<p>You’ll act as an developer, end user, and administrator, each in different
organizations, performing the following steps designed to help you understand
what it’s like to collaborate as two different organizations working
independently, but according to mutually agreed rules in a Hyperledger Fabric
network.</p>
<ul class="simple">
<li><a class="reference external" href="#prerequisites">Set up machine</a> and <a class="reference external" href="#download-samples">download samples</a></li>
<li><a class="reference external" href="#create-network">Create a network</a></li>
<li>Understand the structure of a <a class="reference external" href="#smart-contract">smart contract</a></li>
<li>Work as an organization, <a class="reference external" href="#working-as-magnetocorp">MagnetoCorp</a>, to
<a class="reference external" href="#install-contract">install</a> and <a class="reference external" href="#instantiate-contract">instantiate</a> smart
contract</li>
<li>Understand the structure of a MagnetoCorp
<a class="reference external" href="#application-structure">application</a>, including its
<a class="reference external" href="#application-dependencies">dependencies</a></li>
<li>Configure and use a <a class="reference external" href="#wallet">wallet and identities</a></li>
<li>Run a MagnetoCorp application to <a class="reference external" href="#issue-application">issue a commercial
paper</a></li>
<li>Understand how a second organization, <a class="reference external" href="#working-as-digibank">Digibank</a>, uses
the smart contract in their <a class="reference external" href="#digibank-applications">applications</a></li>
<li>As Digibank, <a class="reference external" href="#run-as-digibank">run</a> applications that
<a class="reference external" href="#buy-application">buy</a> and <a class="reference external" href="#redeem-application">redeem</a> commercial paper</li>
</ul>
<p>This tutorial has been tested on MacOS and Ubuntu, and should work on other
Linux distributions. A Windows version is under development.</p>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before you start, you must install some prerequisite technology required by the
tutorial. We’ve kept these to a minimum so that you can get going quickly.</p>
<p>You <strong>must</strong> have the following technologies installed:</p>
<ul class="simple">
<li><a class="reference external" href="https://nodejs.org/en/about/"><strong>Node</strong></a> version 8.9.0, or higher. Node is
a JavaScript runtime that you can use to run applications and smart
contracts. You are recommended to use the LTS (Long Term Support) version
of node. Install node <a class="reference external" href="https://nodejs.org/en/">here</a>.</li>
<li><a class="reference external" href="https://www.docker.com/get-started"><strong>Docker</strong></a> version 18.06, or higher.
Docker help developers and administrators create standard environments for
building and running applications and smart contracts. Hyperledger Fabric is
provided as a set of Docker images, and the PaperNet smart contract will run
in a docker container. Install Docker
<a class="reference external" href="https://www.docker.com/get-started">here</a>.</li>
</ul>
<p>You <strong>will</strong> find it helpful to install the following technologies:</p>
<ul>
<li><p class="first">A source code editor, such as
<a class="reference external" href="https://code.visualstudio.com/"><strong>Visual Studio Code</strong></a> version 1.28, or
higher. VS Code will help you develop and test your application and smart
contract. Install VS Code <a class="reference external" href="https://code.visualstudio.com/Download">here</a>.</p>
<p>Many excellent code editors are available including
<a class="reference external" href="https://atom.io/">Atom</a>, <a class="reference external" href="http://www.sublimetext.com/">Sublime Text</a> and
<a class="reference external" href="http://www.sublimetext.com/">Brackets</a>.</p>
</li>
</ul>
<p>You <strong>may</strong> find it helpful to install the following technologies as you become
more experienced with application and smart contract development. There’s no
requirement to install these when you first run the tutorial:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/creationix/nvm"><strong>Node Version Manager</strong></a>. NVM helps you
easily switch between different versions of node – it can be really helpful
if you’re working on multiple projects at the same time. Install NVM
<a class="reference external" href="https://github.com/creationix/nvm#installation">here</a>.</li>
</ul>
</div>
<div class="section" id="download-samples">
<h2>Download samples<a class="headerlink" href="#download-samples" title="Permalink to this headline">¶</a></h2>
<p>The commercial paper tutorial is one of the Hyperledger Fabric
<a class="reference external" href="https://github.com/hyperledger/fabric-samples">samples</a> held in a public
<a class="reference external" href="https://www.github.com">GitHub</a> repository called <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code>. As you’re
going to run the tutorial on your machine, your first task is to download the
<code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> repository.</p>
<p><img alt="../_images/commercial_paper.diagram.2.png" src="../_images/commercial_paper.diagram.2.png" />commercialpaper.download <em>Download the
<code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> GitHub repository to your local machine.</em></p>
<p><code class="docutils literal notranslate"><span class="pre">$GOPATH</span></code> is an important environment variable in Hyperledger Fabric; it
identifies the root directory for installation. It is important to get right no
matter which programming language you’re using! Open a new terminal window and
check your <code class="docutils literal notranslate"><span class="pre">$GOPATH</span></code> is set using the <code class="docutils literal notranslate"><span class="pre">env</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env
...
GOPATH=/Users/username/go
NVM_BIN=/Users/username/.nvm/versions/node/v8.11.2/bin
NVM_IOJS_ORG_MIRROR=https://iojs.org/dist
...
</pre></div>
</div>
<p>Use the following
<a class="reference external" href="https://github.com/golang/go/wiki/SettingGOPATH">instructions</a> if your
<code class="docutils literal notranslate"><span class="pre">$GOPATH</span></code> is not set.</p>
<p>You can now create a directory relative to <code class="docutils literal notranslate"><span class="pre">$GOPATH</span></code>where <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> will
be installed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p $GOPATH/src/github.com/hyperledger/
$ cd $GOPATH/src/github.com/hyperledger/
</pre></div>
</div>
<p>Use the <a class="reference external" href="https://git-scm.com/docs/git-clone"><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code></a> command to copy
<a class="reference external" href="https://github.com/hyperledger/fabric-samples"><code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code></a> repository to
this location:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/hyperledger/fabric-samples.git
</pre></div>
</div>
<p>Feel free to examine the directory structure of <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd fabric-samples
$ ls

CODE_OF_CONDUCT.md    balance-transfer            fabric-ca
CONTRIBUTING.md       basic-network               first-network
Jenkinsfile           chaincode                   high-throughput
LICENSE               chaincode-docker-devmode    scripts
MAINTAINERS.md        commercial-paper            README.md
fabcar
</pre></div>
</div>
<p>Notice the <code class="docutils literal notranslate"><span class="pre">commercial-paper</span></code> directory – that’s where our sample is located!</p>
<p>You’ve now completed the first stage of the tutorial! As you proceed, you’ll
open multiple command windows open for different users and components. For
example:</p>
<ul class="simple">
<li>to run applications on behalf of Isabella and Balaji who will trade commercial
paper with each other</li>
<li>to issue commands to on behalf of administrators from MagnetoCorp and
DigiBank, including installing and instantiating smart contracts</li>
<li>to show peer, orderer and CA log output</li>
</ul>
<p>We’ll make it clear when you should run a command from particular command
window; for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ ls
</pre></div>
</div>
<p>indicates that you should run the <code class="docutils literal notranslate"><span class="pre">ls</span></code> command from Isabella’s window.</p>
</div>
<div class="section" id="create-network">
<h2>Create network<a class="headerlink" href="#create-network" title="Permalink to this headline">¶</a></h2>
<p>The tutorial currently uses the basic network; it will be updated soon to a
configuration which better reflects the multi-organization structure of
PaperNet. For now, this network is sufficient to show you how to develop an
application and smart contract.</p>
<p><img alt="../_images/commercial_paper.diagram.3.png" src="../_images/commercial_paper.diagram.3.png" />commercialpaper.network <em>The Hyperledger
Fabric basic network comprises a peer and its ledger database, an orderer and a
certificate authority (CA). Each of these components runs as a docker
container.</em></p>
<p>The peer, its <a class="reference external" href="../ledger/ledger.html#world-state-database-options">ledger</a>, the
orderer and the CA each run in the their own docker container. In production
environments, organizations typically use existing CAs that are shared with
other systems; they’re not dedicated to the Fabric network.</p>
<p>You can manage the basic network using the commands and configuration included
in the <code class="docutils literal notranslate"><span class="pre">fabric-samples\basic-network</span></code> directory. Let’s start the network on your
local machine with the <code class="docutils literal notranslate"><span class="pre">start.sh</span></code> shell script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd fabric-samples/basic-network
$ ./start.sh

docker-compose -f docker-compose.yml up -d ca.example.com orderer.example.com peer0.org1.example.com couchdb
Creating network &quot;net_basic&quot; with the default driver
Pulling ca.example.com (hyperledger/fabric-ca:)...
latest: Pulling from hyperledger/fabric-ca
3b37166ec614: Pull complete
504facff238f: Pull complete
(...)
Pulling orderer.example.com (hyperledger/fabric-orderer:)...
latest: Pulling from hyperledger/fabric-orderer
3b37166ec614: Already exists
504facff238f: Already exists
(...)
Pulling couchdb (hyperledger/fabric-couchdb:)...
latest: Pulling from hyperledger/fabric-couchdb
3b37166ec614: Already exists
504facff238f: Already exists
(...)
Pulling peer0.org1.example.com (hyperledger/fabric-peer:)...
latest: Pulling from hyperledger/fabric-peer
3b37166ec614: Already exists
504facff238f: Already exists
(...)
Creating orderer.example.com ... done
Creating couchdb             ... done
Creating ca.example.com         ... done
Creating peer0.org1.example.com ... done
(...)
2018-11-07 13:47:31.634 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized
2018-11-07 13:47:31.730 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel
</pre></div>
</div>
<p>Notice how the <code class="docutils literal notranslate"><span class="pre">docker-compose</span> <span class="pre">-f</span> <span class="pre">docker-compose.yml</span> <span class="pre">up</span> <span class="pre">-d</span> <span class="pre">ca.example.com...</span></code>
command pulls the four Hyperledger Fabric container images from
<a class="reference external" href="https://hub.docker.com/">DockerHub</a>, and then starts them. These containers
have the most up-to-date version of the software for these Hyperledger Fabric
components. Feel free to explore the <code class="docutils literal notranslate"><span class="pre">basic-network</span></code> directory – we’ll use
much of its contents during this tutorial.</p>
<p>You can list the docker containers that are running the basic-network components
using the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker ps

CONTAINER ID        IMAGE                        COMMAND                  CREATED              STATUS              PORTS                                            NAMES
ada3d078989b        hyperledger/fabric-peer      &quot;peer node start&quot;        About a minute ago   Up About a minute   0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp   peer0.org1.example.com
1fa1fd107bfb        hyperledger/fabric-orderer   &quot;orderer&quot;                About a minute ago   Up About a minute   0.0.0.0:7050-&gt;7050/tcp                           orderer.example.com
53fe614274f7        hyperledger/fabric-couchdb   &quot;tini -- /docker-ent…&quot;   About a minute ago   Up About a minute   4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp       couchdb
469201085a20        hyperledger/fabric-ca        &quot;sh -c &#39;fabric-ca-se…&quot;   About a minute ago   Up About a minute   0.0.0.0:7054-&gt;7054/tcp                           ca.example.com
</pre></div>
</div>
<p>See if you can map these containers to the basic-network (you may need to
horizontally scroll to locate the information):</p>
<ul class="simple">
<li>A peer <code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code> is running in container <code class="docutils literal notranslate"><span class="pre">ada3d078989b</span></code></li>
<li>An orderer <code class="docutils literal notranslate"><span class="pre">orderer.example.com</span></code> is running in container <code class="docutils literal notranslate"><span class="pre">1fa1fd107bfb</span></code></li>
<li>A CouchDB database <code class="docutils literal notranslate"><span class="pre">couchdb</span></code> is running in container <code class="docutils literal notranslate"><span class="pre">53fe614274f7</span></code></li>
<li>A CA <code class="docutils literal notranslate"><span class="pre">ca.example.com</span></code> is running in container <code class="docutils literal notranslate"><span class="pre">469201085a20</span></code></li>
</ul>
<p>These containers all form a <a class="reference external" href="https://docs.docker.com/network/">docker network</a>
called <code class="docutils literal notranslate"><span class="pre">net_basic</span></code>. You can view the network with the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">network</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker network inspect net_basic

    {
        &quot;Name&quot;: &quot;net_basic&quot;,
        &quot;Id&quot;: &quot;62e9d37d00a0eda6c6301a76022c695f8e01258edaba6f65e876166164466ee5&quot;,
        &quot;Created&quot;: &quot;2018-11-07T13:46:30.4992927Z&quot;,
        &quot;Containers&quot;: {
            &quot;1fa1fd107bfbe61522e4a26a57c2178d82b2918d5d423e7ee626c79b8a233624&quot;: {
                &quot;Name&quot;: &quot;orderer.example.com&quot;,
                &quot;IPv4Address&quot;: &quot;172.20.0.4/16&quot;,
            },
            &quot;469201085a20b6a8f476d1ac993abce3103e59e3a23b9125032b77b02b715f2c&quot;: {
                &quot;Name&quot;: &quot;ca.example.com&quot;,
                &quot;IPv4Address&quot;: &quot;172.20.0.2/16&quot;,
            },
            &quot;53fe614274f7a40392210f980b53b421e242484dd3deac52bbfe49cb636ce720&quot;: {
                &quot;Name&quot;: &quot;couchdb&quot;,
                &quot;IPv4Address&quot;: &quot;172.20.0.3/16&quot;,
            },
            &quot;ada3d078989b568c6e060fa7bf62301b4bf55bed8ac1c938d514c81c42d8727a&quot;: {
                &quot;Name&quot;: &quot;peer0.org1.example.com&quot;,
                &quot;IPv4Address&quot;: &quot;172.20.0.5/16&quot;,
            }
        },
        &quot;Labels&quot;: {}
    }
</pre></div>
</div>
<p>See how the four containers use different IP addresses, while being part of a
single docker network. (We’ve abbreviated the output for clarity.)</p>
<p>To recap: you’ve downloaded the Hyperledger Fabric samples repository from
GitHub and you’ve got the basic network running on your local machine. Let’s now
start to play the role of MagnetoCorp, who wish to trade commercial paper.</p>
</div>
<div class="section" id="working-as-magnetocorp">
<h2>Working as MagnetoCorp<a class="headerlink" href="#working-as-magnetocorp" title="Permalink to this headline">¶</a></h2>
<p>To monitor the MagnetoCorp components of PaperNet, an administrator can view the
aggregated output from a set of docker containers using the <code class="docutils literal notranslate"><span class="pre">logspout</span></code>
<a class="reference external" href="https://github.com/gliderlabs/logspout#logspout">tool</a>. It collects the
different output streams into one place, making it easy to see what’s happening
from a single window. This can be really helpful for administrators when
installing smart contracts or for developers when invoking smart contracts, for
example.</p>
<p>Let’s now monitor PaperNet as a MagnetoCorp administrator. Open a new window in
the <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> directory, and locate and run the <code class="docutils literal notranslate"><span class="pre">monitordocker.sh</span></code>
script to start the <code class="docutils literal notranslate"><span class="pre">logspout</span></code> tool for the PaperNet docker containers
associated with the docker network <code class="docutils literal notranslate"><span class="pre">net_basic</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ cd commercial-paper/organization/magnetocorp/configuration/cli/
(magnetocorp admin)$ ./monitordocker.sh net_basic
...
latest: Pulling from gliderlabs/logspout
4fe2ade4980c: Pull complete
decca452f519: Pull complete
(...)
Starting monitoring on all containers on the network net_basic
b7f3586e5d0233de5a454df369b8eadab0613886fc9877529587345fc01a3582
</pre></div>
</div>
<p>Note that you can pass a port number to the above command if the default port in <code class="docutils literal notranslate"><span class="pre">monitordocker.sh</span></code> is already in use.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ ./monitordocker.sh net_basic &lt;port_number&gt;
</pre></div>
</div>
<p>This window will now show output from the docker containers, so let’s start
another terminal window which will allow the MagnetoCorp administrator to
interact with the network.</p>
<p><img alt="../_images/commercial_paper.diagram.4.png" src="../_images/commercial_paper.diagram.4.png" />commercialpaper.workmagneto <em>A MagnetoCorp
administrator interacts with the network via a docker container.</em></p>
<p>To interact with PaperNet, a MagnetoCorp administrator needs to use the
Hyperledger Fabric <code class="docutils literal notranslate"><span class="pre">peer</span></code> commands. Conveniently, these are available pre-built
in the <code class="docutils literal notranslate"><span class="pre">hyperledger/fabric-tools</span></code>
<a class="reference external" href="https://hub.docker.com/r/hyperledger/fabric-tools/">docker image</a>.</p>
<p>Let’s start a MagnetoCorp-specific docker container for the administrator using
the <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code> <a class="reference external" href="https://docs.docker.com/compose/overview/">command</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ cd commercial-paper/organization/magnetocorp/configuration/cli/
(magnetocorp admin)$ docker-compose -f docker-compose.yml up -d cliMagnetoCorp

Pulling cliMagnetoCorp (hyperledger/fabric-tools:)...
latest: Pulling from hyperledger/fabric-tools
3b37166ec614: Already exists
(...)
Digest: sha256:058cff3b378c1f3ebe35d56deb7bf33171bf19b327d91b452991509b8e9c7870
Status: Downloaded newer image for hyperledger/fabric-tools:latest
Creating cliMagnetoCorp ... done
</pre></div>
</div>
<p>Again, see how the <code class="docutils literal notranslate"><span class="pre">hyperledger/fabric-tools</span></code> docker image was retrieved from
Docker Hub and added to the network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ docker ps

CONTAINER ID        IMAGE                        COMMAND                  CREATED              STATUS              PORTS                                            NAMES
562a88b25149        hyperledger/fabric-tools     &quot;/bin/bash&quot;              About a minute ago   Up About a minute                                                    cliMagnetoCorp
b7f3586e5d02        gliderlabs/logspout          &quot;/bin/logspout&quot;          7 minutes ago        Up 7 minutes        127.0.0.1:8000-&gt;80/tcp                           logspout
ada3d078989b        hyperledger/fabric-peer      &quot;peer node start&quot;        29 minutes ago       Up 29 minutes       0.0.0.0:7051-&gt;7051/tcp, 0.0.0.0:7053-&gt;7053/tcp   peer0.org1.example.com
1fa1fd107bfb        hyperledger/fabric-orderer   &quot;orderer&quot;                29 minutes ago       Up 29 minutes       0.0.0.0:7050-&gt;7050/tcp                           orderer.example.com
53fe614274f7        hyperledger/fabric-couchdb   &quot;tini -- /docker-ent…&quot;   29 minutes ago       Up 29 minutes       4369/tcp, 9100/tcp, 0.0.0.0:5984-&gt;5984/tcp       couchdb
469201085a20        hyperledger/fabric-ca        &quot;sh -c &#39;fabric-ca-se…&quot;   29 minutes ago       Up 29 minutes       0.0.0.0:7054-&gt;7054/tcp                           ca.example.com
</pre></div>
</div>
<p>The MagnetoCorp administrator will use the command line in container
<code class="docutils literal notranslate"><span class="pre">562a88b25149</span></code> to interact with PaperNet. Notice also the <code class="docutils literal notranslate"><span class="pre">logspout</span></code> container
<code class="docutils literal notranslate"><span class="pre">b7f3586e5d02</span></code>; this is capturing the output of all other docker containers for
the <code class="docutils literal notranslate"><span class="pre">monitordocker.sh</span></code> command.</p>
<p>Let’s now use this command line to interact with PaperNet as the MagnetoCorp
administrator.</p>
</div>
<div class="section" id="smart-contract">
<h2>Smart contract<a class="headerlink" href="#smart-contract" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">issue</span></code>, <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> are the three functions at the heart of the PaperNet
smart contract. It is used by applications to submit transactions which
correspondingly issue, buy and redeem commercial paper on the ledger. Our next
task is to examine this smart contract.</p>
<p>Open a new terminal window to represent a MagnetoCorp developer and change to
the directory that contains MagnetoCorp’s copy of the smart contract to view it
with your chosen editor (VS Code in this tutorial):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp developer)$ cd commercial-paper/organization/magnetocorp/contract
(magnetocorp developer)$ code .
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">lib</span></code> directory of the folder, you’ll see <code class="docutils literal notranslate"><span class="pre">papercontract.js</span></code> file – this
contains the commercial paper smart contract!</p>
<p><img alt="../_images/commercial_paper.diagram.10.png" src="../_images/commercial_paper.diagram.10.png" />commercialpaper.vscode1 <em>An example code
editor displaying the commercial paper smart contract in <code class="docutils literal notranslate"><span class="pre">papercontract.js</span></code></em></p>
<p><code class="docutils literal notranslate"><span class="pre">papercontract.js</span></code> is a JavaScript program designed to run in the node.js
environment. Note the following key program lines:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">{</span> <span class="pre">Contract,</span> <span class="pre">Context</span> <span class="pre">}</span> <span class="pre">=</span> <span class="pre">require('fabric-contract-api');</span></code></p>
<p>This statement brings into scope two key Hyperledger Fabric classes that will
be used extensively by the smart contract  – <code class="docutils literal notranslate"><span class="pre">Contract</span></code> and <code class="docutils literal notranslate"><span class="pre">Context</span></code>. You
can learn more about these classes in the
<a class="reference external" href="https://fabric-shim.github.io/"><code class="docutils literal notranslate"><span class="pre">fabric-shim</span></code> JSDOCS</a>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">CommercialPaperContract</span> <span class="pre">extends</span> <span class="pre">Contract</span> <span class="pre">{</span></code></p>
<p>This defines the smart contract class <code class="docutils literal notranslate"><span class="pre">CommercialPaperContract</span></code> based on the
built-in Fabric <code class="docutils literal notranslate"><span class="pre">Contract</span></code> class.  The methods which implement the key
transactions to <code class="docutils literal notranslate"><span class="pre">issue</span></code>, <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> commercial paper are defined
within this class.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">issue(ctx,</span> <span class="pre">issuer,</span> <span class="pre">paperNumber,</span> <span class="pre">issueDateTime,</span> <span class="pre">maturityDateTime...)</span> <span class="pre">{</span></code></p>
<p>This method defines the commercial paper <code class="docutils literal notranslate"><span class="pre">issue</span></code> transaction for PaperNet. The
parameters that are passed to this method will be used to create the new
commercial paper.</p>
<p>Locate and examine the <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> transactions within the smart
contract.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">paper</span> <span class="pre">=</span> <span class="pre">CommercialPaper.createInstance(issuer,</span> <span class="pre">paperNumber,</span> <span class="pre">issueDateTime...);</span></code></p>
<p>Within the <code class="docutils literal notranslate"><span class="pre">issue</span></code> transaction, this statement creates a new commercial paper
in memory using the <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code> class with the supplied transaction
inputs. Examine the <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> transactions to see how they similarly
use this class.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">ctx.paperList.addPaper(paper);</span></code></p>
<p>This statement adds the new commercial paper to the ledger using
<code class="docutils literal notranslate"><span class="pre">ctx.paperList</span></code>, an instance of a <code class="docutils literal notranslate"><span class="pre">PaperList</span></code> class that was created when the
smart contract context <code class="docutils literal notranslate"><span class="pre">CommercialPaperContext</span></code> was initialized. Again,
examine the <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> methods to see how they use this class.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">paper.toBuffer();</span></code></p>
<p>This statement returns a binary buffer as response from the <code class="docutils literal notranslate"><span class="pre">issue</span></code>
transaction for processing by the caller of the smart contract.</p>
</li>
</ul>
<p>Feel free to examine other files in the <code class="docutils literal notranslate"><span class="pre">contract</span></code> directory to understand how
the smart contract works, and read in detail how <code class="docutils literal notranslate"><span class="pre">papercontract.js</span></code> is
designed in the smart contract <a class="reference external" href="../developapps/smartcontract.html">topic</a>.</p>
</div>
<div class="section" id="install-contract">
<h2>Install contract<a class="headerlink" href="#install-contract" title="Permalink to this headline">¶</a></h2>
<p>Before <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> can be invoked by applications, it must be installed onto
the appropriate peer nodes in PaperNet.  MagnetoCorp and DigiBank administrators
are able to install <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> onto peers over which they respectively have
authority.</p>
<p><img alt="../_images/commercial_paper.diagram.6.png" src="../_images/commercial_paper.diagram.6.png" />commercialpaper.install <em>A MagnetoCorp
administrator installs a copy of the <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> onto a MagnetoCorp peer.</em></p>
<p>Smart contracts are the focus of application development, and are contained
within a Hyperledger Fabric artifact called <a class="reference external" href="../chaincode.html">chaincode</a>. One
or more smart contracts can be defined within a single chaincode, and installing
a chaincode will allow them to be consumed by the different organizations in
PaperNet.  It means that only administrators need to worry about chaincode;
everyone else can think in terms of smart contracts.</p>
<p>The MagnetoCorp administrator uses the <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">chaincode</span> <span class="pre">install</span></code> command to copy
the <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> smart contract from their local machine’s file system to the
file system within the target peer’s docker container. Once the smart contract
is installed on the peer and instantiated on a channel,
<code class="docutils literal notranslate"><span class="pre">papercontract</span></code> can be invoked by applications, and interact with the ledger
database via the
<a class="reference external" href="https://fabric-shim.github.io/release-1.3/fabric-shim.ChaincodeStub.html#putState__anchor">putState()</a>
and
<a class="reference external" href="https://fabric-shim.github.io/release-1.3/fabric-shim.ChaincodeStub.html#getState__anchor">getState()</a>
Fabric APIs. Examine how these APIs are used by <code class="docutils literal notranslate"><span class="pre">StateList</span></code> class within
<code class="docutils literal notranslate"><span class="pre">ledger-api\statelist.js</span></code>.</p>
<p>Let’s now install <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> as the MagnetoCorp administrator. In the
MagnetoCorp administrator’s command window, use the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">exec</span></code> command to run
the <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">chaincode</span> <span class="pre">install</span></code> command in the <code class="docutils literal notranslate"><span class="pre">cliMagnetCorp</span></code> container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ docker exec cliMagnetoCorp peer chaincode install -n papercontract -v 0 -p /opt/gopath/src/github.com/contract -l node

2018-11-07 14:21:48.400 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc
2018-11-07 14:21:48.400 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc
2018-11-07 14:21:48.466 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cliMagnetCorp</span></code> container has set
<code class="docutils literal notranslate"><span class="pre">CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span></code> to target its commands to
<code class="docutils literal notranslate"><span class="pre">peer0.org1.example.com</span></code>, and the <code class="docutils literal notranslate"><span class="pre">INFO</span> <span class="pre">003</span> <span class="pre">Installed</span> <span class="pre">remotely...</span></code> indicates
<code class="docutils literal notranslate"><span class="pre">papercontract</span></code> has been successfully installed on this peer. Currently, the
MagnetoCorp administrator only has to install a copy of <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> on a
single MagentoCorp peer.</p>
<p>Note how <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">chaincode</span> <span class="pre">install</span></code> command specified the smart contract path,
<code class="docutils literal notranslate"><span class="pre">-p</span></code>, relative to the <code class="docutils literal notranslate"><span class="pre">cliMagnetoCorp</span></code> container’s file system:
<code class="docutils literal notranslate"><span class="pre">/opt/gopath/src/github.com/contract</span></code>. This path has been mapped to the local
file system path <code class="docutils literal notranslate"><span class="pre">.../organization/magnetocorp/contract</span></code> via the
<code class="docutils literal notranslate"><span class="pre">magnetocorp/configuration/cli/docker-compose.yml</span></code> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">volumes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./../../../../organization/magnetocorp:/opt/gopath/src/github.com/</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>See how the <code class="docutils literal notranslate"><span class="pre">volume</span></code> directive maps <code class="docutils literal notranslate"><span class="pre">organization/magnetocorp</span></code> to
<code class="docutils literal notranslate"><span class="pre">/opt/gopath/src/github.com/</span></code> providing this container access to your local file
system where MagnetoCorp’s copy of the <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> smart contract is held.</p>
<p>You can read more about <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span></code>
<a class="reference external" href="https://docs.docker.com/compose/overview/">here</a> and <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">chaincode</span> <span class="pre">install</span></code>
command <a class="reference external" href="../commands/peerchaincode.html">here</a>.</p>
</div>
<div class="section" id="instantiate-contract">
<h2>Instantiate contract<a class="headerlink" href="#instantiate-contract" title="Permalink to this headline">¶</a></h2>
<p>Now that <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> chaincode containing the <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code> smart
contract is installed on the required PaperNet peers, an administrator can make
it available to different network channels, so that it can be invoked by
applications connected to those channels. Because we’re using the basic network
configuration for PaperNet, we’re only going to make <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> available
in a single network channel, <code class="docutils literal notranslate"><span class="pre">mychannel</span></code>.</p>
<p><img alt="../_images/commercial_paper.diagram.7.png" src="../_images/commercial_paper.diagram.7.png" />commercialpaper.instant <em>A MagnetoCorp
administrator instantiates <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> chaincode containing the smart
contract. A new docker chaincode container will be created to run
<code class="docutils literal notranslate"><span class="pre">papercontract</span></code>.</em></p>
<p>The MagnetoCorp administrator uses the <code class="docutils literal notranslate"><span class="pre">peer</span> <span class="pre">chaincode</span> <span class="pre">instantiate</span></code> command to
instantiate <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> on <code class="docutils literal notranslate"><span class="pre">mychannel</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ docker exec cliMagnetoCorp peer chaincode instantiate -n papercontract -v 0 -l node -c &#39;{&quot;Args&quot;:[&quot;org.papernet.commercialpaper:instantiate&quot;]}&#39; -C mychannel -P &quot;AND (&#39;Org1MSP.member&#39;)&quot;

2018-11-07 14:22:11.162 UTC [chaincodeCmd] InitCmdFactory -&gt; INFO 001 Retrieved channel (mychannel) orderer endpoint: orderer.example.com:7050
2018-11-07 14:22:11.163 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default escc
2018-11-07 14:22:11.163 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default vscc
</pre></div>
</div>
<p>One of the most important parameters on <code class="docutils literal notranslate"><span class="pre">instantiate</span></code> is <code class="docutils literal notranslate"><span class="pre">-P</span></code>. It specifies the
<a class="reference external" href="../endorsement-policies.html">endorsement policy</a> for <code class="docutils literal notranslate"><span class="pre">papercontract</span></code>,
describing the set of organizations that must endorse (execute and sign) a
transaction before it can be determined as valid. All transactions, whether
valid or invalid, will be recorded on the <a class="reference external" href="../ledger/ledger.html#blockchain">ledger blockchain</a>,
but only valid transactions will update the <a class="reference external" href="../ledger/ledger.html#world-state">world
state</a>.</p>
<p>In passing, see how <code class="docutils literal notranslate"><span class="pre">instantiate</span></code> passes the orderer address
<code class="docutils literal notranslate"><span class="pre">orderer.example.com:7050</span></code>. This is because it additionally submits an
instantiate transaction to the orderer, which will include the transaction
in the next block and distribute it to all peers that have joined
<code class="docutils literal notranslate"><span class="pre">mychannel</span></code>, enabling any peer to execute the chaincode in their own
isolated chaincode container. Note that <code class="docutils literal notranslate"><span class="pre">instantiate</span></code> only needs to be issued
once for <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> even though typically it is installed on many peers.</p>
<p>See how a <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> container has been started with the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code>
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp admin)$ docker ps

CONTAINER ID        IMAGE                                              COMMAND                  CREATED             STATUS              PORTS          NAMES
4fac1b91bfda        dev-peer0.org1.example.com-papercontract-0-d96...  &quot;/bin/sh -c &#39;cd /usr…&quot;   2 minutes ago       Up 2 minutes                       dev-peer0.org1.example.com-papercontract-0
</pre></div>
</div>
<p>Notice that the container is named
<code class="docutils literal notranslate"><span class="pre">dev-peer0.org1.example.com-papercontract-0-d96...</span></code> to indicate which peer
started it, and the fact that it’s running <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> version <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>Now that we’ve got a basic PaperNet up and running, and <code class="docutils literal notranslate"><span class="pre">papercontract</span></code>
installed and instantiated, let’s turn our attention to the MagnetoCorp
application which issues a commercial paper.</p>
</div>
<div class="section" id="application-structure">
<h2>Application structure<a class="headerlink" href="#application-structure" title="Permalink to this headline">¶</a></h2>
<p>The smart contract contained in <code class="docutils literal notranslate"><span class="pre">papercontract</span></code> is called by MagnetoCorp’s
application <code class="docutils literal notranslate"><span class="pre">issue.js</span></code>. Isabella uses this application to submit a transaction
to the ledger which issues commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code>. Let’s quickly examine how
the <code class="docutils literal notranslate"><span class="pre">issue</span></code> application works.</p>
<p><img alt="../_images/commercial_paper.diagram.8.png" src="../_images/commercial_paper.diagram.8.png" />commercialpaper.application <em>A gateway
allows an application to focus on transaction generation, submission and
response. It coordinates transaction proposal, ordering and notification
processing between the different network components.</em></p>
<p>Because the <code class="docutils literal notranslate"><span class="pre">issue</span></code> application submits transactions on behalf of Isabella, it
starts by retrieving Isabella’s X.509 certificate from her
<a class="reference external" href="../developapps/wallet.html">wallet</a>, which might be stored on the local file
system or a Hardware Security Module
<a class="reference external" href="https://en.wikipedia.org/wiki/Hardware_security_module">HSM</a>. The <code class="docutils literal notranslate"><span class="pre">issue</span></code>
application is then able to utilize the gateway to submit transactions on the
channel. The Hyperledger Fabric SDK provides a
<a class="reference external" href="../developapps/gateway.html">gateway</a> abstraction so that applications can
focus on application logic while delegating network interaction to the
gateway. Gateways and wallets make it straightforward to write Hyperledger
Fabric applications.</p>
<p>So let’s examine the <code class="docutils literal notranslate"><span class="pre">issue</span></code> application that Isabella is going to use. open a
separate terminal window for her, and in <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code> locate the MagnetoCorp
<code class="docutils literal notranslate"><span class="pre">/application</span></code> folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp user)$ cd commercial-paper/organization/magnetocorp/application/
(magnetocorp user)$ ls

addToWallet.js		issue.js		package.json
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">addToWallet.js</span></code> is the program that Isabella is going to use to load her
identity into her wallet, and <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> will use this identity to create
commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code> on behalf of MagnetoCorp by invoking <code class="docutils literal notranslate"><span class="pre">papercontract</span></code>.</p>
<p>Change to the directory that contains MagnetoCorp’s copy of the application
<code class="docutils literal notranslate"><span class="pre">issue.js</span></code>, and use your code editor to examine it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp user)$ cd commercial-paper/organization/magnetocorp/application
(magnetocorp user)$ code issue.js
</pre></div>
</div>
<p>Examine this directory; it contains the issue application and all its
dependencies.</p>
<p><img alt="../_images/commercial_paper.diagram.11.png" src="../_images/commercial_paper.diagram.11.png" />commercialpaper.vscode2 <em>A code editor
displaying the contents of the commercial paper application directory.</em></p>
<p>Note the following key program lines in <code class="docutils literal notranslate"><span class="pre">issue.js</span></code>:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">{</span> <span class="pre">FileSystemWallet,</span> <span class="pre">Gateway</span> <span class="pre">}</span> <span class="pre">=</span> <span class="pre">require('fabric-network');</span></code></p>
<p>This statement brings two key Hyperledger Fabric SDK classes into scope –
<code class="docutils literal notranslate"><span class="pre">Wallet</span></code> and <code class="docutils literal notranslate"><span class="pre">Gateway</span></code>. Because Isabella’s X.509 certificate is in the local
file system, the application uses <code class="docutils literal notranslate"><span class="pre">FileSystemWallet</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">wallet</span> <span class="pre">=</span> <span class="pre">new</span> <span class="pre">FileSystemWallet('../identity/user/isabella/wallet');</span></code></p>
<p>This statement identifies that the application will use <code class="docutils literal notranslate"><span class="pre">isabella</span></code> wallet when
it connects to the blockchain network channel. The application will select a
particular identity within <code class="docutils literal notranslate"><span class="pre">isabella</span></code> wallet. (The wallet must have been
loaded with the Isabella’s X.509 certificate – that’s what <code class="docutils literal notranslate"><span class="pre">addToWallet.js</span></code>
does.)</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">gateway.connect(connectionProfile,</span> <span class="pre">connectionOptions);</span></code></p>
<p>This line of code connects to the network using the gateway identified by
<code class="docutils literal notranslate"><span class="pre">connectionProfile</span></code>, using the identity referred to in <code class="docutils literal notranslate"><span class="pre">ConnectionOptions</span></code>.</p>
<p>See how <code class="docutils literal notranslate"><span class="pre">../gateway/networkConnection.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">User1&#64;org1.example.com</span></code> are
used for these values respectively.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">network</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">gateway.getNetwork('mychannel');</span></code></p>
<p>This connects the application to the network channel <code class="docutils literal notranslate"><span class="pre">mychannel</span></code>, where the
<code class="docutils literal notranslate"><span class="pre">papercontract</span></code> was previously instantiated.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">contract</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">network.getContract('papercontract',</span> <span class="pre">'org.papernet.comm...');</span></code></p>
</li>
</ul>
<p>This statement gives the application addressability to smart contract defined
by the namespace <code class="docutils literal notranslate"><span class="pre">org.papernet.commercialpaper</span></code> within <code class="docutils literal notranslate"><span class="pre">papercontract</span></code>. Once
an application has issued getContract, it can submit any transaction
implemented within it.</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">issueResponse</span> <span class="pre">=</span> <span class="pre">await</span> <span class="pre">contract.submitTransaction('issue',</span> <span class="pre">'MagnetoCorp',</span> <span class="pre">'00001'...);</span></code></p>
<p>This line of code submits the a transaction to the network using the <code class="docutils literal notranslate"><span class="pre">issue</span></code>
transaction defined within the smart contract. <code class="docutils literal notranslate"><span class="pre">MagnetoCorp</span></code>, <code class="docutils literal notranslate"><span class="pre">00001</span></code>… are
the values to be used by the <code class="docutils literal notranslate"><span class="pre">issue</span></code> transaction to create a new commercial
paper.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">paper</span> <span class="pre">=</span> <span class="pre">CommercialPaper.fromBuffer(issueResponse);</span></code></p>
<p>This statement processes the response from the <code class="docutils literal notranslate"><span class="pre">issue</span></code> transaction. The
response needs to deserialized from a buffer into <code class="docutils literal notranslate"><span class="pre">paper</span></code>, a <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code>
object which can interpreted correctly by the application.</p>
</li>
</ul>
<p>Feel free to examine other files in the <code class="docutils literal notranslate"><span class="pre">/application</span></code> directory to understand
how <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> works, and read in detail how it is implemented in the
application <a class="reference external" href="../developapps/application.html">topic</a>.</p>
</div>
<div class="section" id="application-dependencies">
<h2>Application dependencies<a class="headerlink" href="#application-dependencies" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> application is written in JavaScript and designed to run in the
node.js environment that acts as a client to the PaperNet network.
As is common practice, MagnetoCorp’s application is built on many
external node packages – to improve quality and speed of development. Consider
how <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> includes the <code class="docutils literal notranslate"><span class="pre">js-yaml</span></code>
<a class="reference external" href="https://www.npmjs.com/package/js-yaml">package</a> to process the YAML gateway
connection profile, or the <code class="docutils literal notranslate"><span class="pre">fabric-network</span></code>
<a class="reference external" href="https://www.npmjs.com/package/fabric-network">package</a> to access the <code class="docutils literal notranslate"><span class="pre">Gateway</span></code>
and <code class="docutils literal notranslate"><span class="pre">Wallet</span></code> classes:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">yaml</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;js-yaml&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="p">{</span> <span class="nx">FileSystemWallet</span><span class="p">,</span> <span class="nx">Gateway</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fabric-network&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>These packages have to be downloaded from <a class="reference external" href="https://www.npmjs.com/">npm</a> to the
local file system using the <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code> command. By convention, packages must
be installed into an application-relative <code class="docutils literal notranslate"><span class="pre">/node_modules</span></code> directory for use at
runtime.</p>
<p>Examine the <code class="docutils literal notranslate"><span class="pre">package.json</span></code> file to see how <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> identifies the packages to
download and their exact versions:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>  &quot;dependencies&quot;: {
    &quot;fabric-network&quot;: &quot;^1.4.0-beta&quot;,
    &quot;fabric-client&quot;: &quot;^1.4.0-beta&quot;,
    &quot;js-yaml&quot;: &quot;^3.12.0&quot;
  },
</pre></div>
</div>
<p><strong>npm</strong> versioning is very powerful; you can read more about it
<a class="reference external" href="https://docs.npmjs.com/getting-started/semantic-versioning">here</a>.</p>
<p>Let’s install these packages with the <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code> command – this may take up
to a minute to complete:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp user)$ npm install

(           ) extract:lodash: sill extract ansi-styles@3.2.1
(...)
added 738 packages in 46.701s
</pre></div>
</div>
<p>See how this command has updated the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(magnetocorp user)$ ls

addToWallet.js		node_modules	      	package.json
issue.js	      	package-lock.json
</pre></div>
</div>
<p>Examine the <code class="docutils literal notranslate"><span class="pre">node_modules</span></code> directory to see the packages that have been
installed. There are lots, because <code class="docutils literal notranslate"><span class="pre">js-yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">fabric-network</span></code> are themselves
built on other npm packages! Helpfully, the <code class="docutils literal notranslate"><span class="pre">package-lock.json</span></code>
<a class="reference external" href="https://docs.npmjs.com/files/package-lock.json">file</a> identifies the exact
versions installed, which can prove invaluable if you want to exactly reproduce
environments; to test, diagnose problems or deliver proven applications for
example.</p>
</div>
<div class="section" id="wallet">
<h2>Wallet<a class="headerlink" href="#wallet" title="Permalink to this headline">¶</a></h2>
<p>Isabella is almost ready to run <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> to issue MagnetoCorp commercial paper
<code class="docutils literal notranslate"><span class="pre">00001</span></code>; there’s just one remaining task to perform! As <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> acts on
behalf of Isabella, and therefore MagnetoCorp, it will use identity from her
<a class="reference external" href="../developapps/wallet.html">wallet</a> that reflects these facts. We now need to
perform this one-time activity of adding appropriate X.509 credentials to her
wallet.</p>
<p>In Isabella’s terminal window, run the <code class="docutils literal notranslate"><span class="pre">addToWallet.js</span></code> program to add identity
information to her wallet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ node addToWallet.js

done
</pre></div>
</div>
<p>Isabella can store multiple identities in her wallet, though in our example, she
only uses one – <code class="docutils literal notranslate"><span class="pre">User1&#64;org.example.com</span></code>. This identity is currently associated
with the basic network, rather than a more realistic PaperNet configuration –
we’ll update this tutorial soon.</p>
<p><code class="docutils literal notranslate"><span class="pre">addToWallet.js</span></code> is a simple file-copying program which you can examine at your
leisure. It moves an identity from the basic network sample to Isabella’s
wallet. Let’s focus on the result of this program – the contents of
the wallet which will be used to submit transactions to <code class="docutils literal notranslate"><span class="pre">PaperNet</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ ls ../identity/user/isabella/wallet/

User1@org1.example.com
</pre></div>
</div>
<p>See how the directory structure maps the <code class="docutils literal notranslate"><span class="pre">User1&#64;org1.example.com</span></code> identity –
other identities used by Isabella would have their own folder. Within this
directory you’ll find the identity information that <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> will use on
behalf of <code class="docutils literal notranslate"><span class="pre">isabella</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ ls ../identity/user/isabella/wallet/User1@org1.example.com

User1@org1.example.com      c75bd6911a...-priv      c75bd6911a...-pub
</pre></div>
</div>
<p>Notice:</p>
<ul>
<li><p class="first">a private key <code class="docutils literal notranslate"><span class="pre">c75bd6911a...-priv</span></code> used to sign transactions on Isabella’s
behalf, but not distributed outside of her immediate control.</p>
</li>
<li><p class="first">a public key <code class="docutils literal notranslate"><span class="pre">c75bd6911a...-pub</span></code> which is cryptographically linked to
Isabella’s private key. This is wholly contained within Isabella’s X.509
certificate.</p>
</li>
<li><p class="first">a certificate <code class="docutils literal notranslate"><span class="pre">User1&#64;org.example.com</span></code> which contains Isabella’s public key
and other X.509 attributes added by the Certificate Authority at certificate
creation. This certificate is distributed to the network so that different
actors at different times can cryptographically verify information created by
Isabella’s private key.</p>
<p>Learn more about certificates
<a class="reference external" href="../identity/identity.html#digital-certificates">here</a>. In practice, the
certificate file also contains some Fabric-specific metadata such as
Isabella’s organization and role – read more in the
<a class="reference external" href="../developapps/wallet.html">wallet</a> topic.</p>
</li>
</ul>
</div>
<div class="section" id="issue-application">
<h2>Issue application<a class="headerlink" href="#issue-application" title="Permalink to this headline">¶</a></h2>
<p>Isabella can now use <code class="docutils literal notranslate"><span class="pre">issue.js</span></code> to submit a transaction that will issue
MagnetoCorp commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(isabella)$ node issue.js

Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper issue transaction.
Process issue transaction response.
MagnetoCorp commercial paper : 00001 successfully issued for value 5000000
Transaction complete.
Disconnect from Fabric gateway.
Issue program complete.
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">node</span></code> command initializes a node.js environment, and runs <code class="docutils literal notranslate"><span class="pre">issue.js</span></code>. We
can see from the program output that MagnetoCorp commercial paper 00001 was
issued with a face value of 5M USD.</p>
<p>As you’ve seen, to achieve this, the application invokes the <code class="docutils literal notranslate"><span class="pre">issue</span></code> transaction
defined in the <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code> smart contract within <code class="docutils literal notranslate"><span class="pre">papercontract.js</span></code>. This
had been installed and instantiated in the network by the MagnetoCorp
administrator. It’s the smart contract which interacts with the ledger via the
Fabric APIs, most notably <code class="docutils literal notranslate"><span class="pre">putState()</span></code> and <code class="docutils literal notranslate"><span class="pre">getState()</span></code>, to represent the new
commercial paper as a vector state within the world state. We’ll see how this
vector state is subsequently manipulated by the <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> transactions
also defined within the smart contract.</p>
<p>All the time, the underlying Fabric SDK handles the transaction endorsement,
ordering and notification process, making the application’s logic
straightforward; the SDK uses a <a class="reference external" href="../developapps/gateway.html">gateway</a> to
abstract away network details and
<a class="reference external" href="../developapps/connectoptions.html">connectionOptions</a> to declare more advanced
processing strategies such as transaction retry.</p>
<p>Let’s now follow the lifecycle of MagnetoCorp <code class="docutils literal notranslate"><span class="pre">00001</span></code> by switching our emphasis
to DigiBank, who will buy the commercial paper.</p>
</div>
<div class="section" id="working-as-digibank">
<h2>Working as DigiBank<a class="headerlink" href="#working-as-digibank" title="Permalink to this headline">¶</a></h2>
<p>Now that commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code>has been issued by MagnetoCorp, let’s switch
context to interact with PaperNet as employees of DigiBank. First, we’ll act as
administrator who will create a console configured to interact with PaperNet.
Then Balaji, an end user, will use Digibank’s <code class="docutils literal notranslate"><span class="pre">buy</span></code> application to buy
commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code>, moving it to the next stage in its lifecycle.</p>
<p><img alt="../_images/commercial_paper.diagram.5.png" src="../_images/commercial_paper.diagram.5.png" />commercialpaper.workdigi <em>DigiBank
administrators and applications interact with the PaperNet network.</em></p>
<p>As the tutorial currently uses the basic network for PaperNet, the network
configuration is quite simple. Administrators use a console similar to
MagnetoCorp, but configured for Digibank’s file system. Likewise, Digibank end
users will use applications which invoke the same smart contract as MagnetoCorp
applications, though they contain Digibank-specific logic and configuration.
It’s the smart contract which captures the shared business process, and the
ledger which holds the shared business data, no matter which applications call
them.</p>
<p>Let’s open up a separate terminal to allow the DigiBank administrator to
interact with PaperNet. In <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(digibank admin)$ cd commercial-paper/organization/digibank/configuration/cli/
(digibank admin)$ docker-compose -f docker-compose.yml up -d cliDigiBank

(...)
Creating cliDigiBank ... done
</pre></div>
</div>
<p>This docker container is now available for Digibank administrators to interact
with the network:</p>
<div class="highlight-(digibank admin)$ docker ps notranslate"><div class="highlight"><pre><span></span>CONTAINER ID        IMAGE                            COMMAND                  CREATED             STATUS              PORT         NAMES
858c2d2961d4        hyperledger/fabric-tools         &quot;/bin/bash&quot;              18 seconds ago      Up 18 seconds                    cliDigiBank
</pre></div>
</div>
<p>In this tutorial, you’ll use the command line container named <code class="docutils literal notranslate"><span class="pre">cliDigiBank</span></code> to
interact with the network on behalf of DigiBank. We’ve not shown all the docker
containers, and in the real world DigiBank users would only see the network
components (peers, orderers, CAs) to which they have access.</p>
<p>Digibank’s administrator doesn’t have much to do in this tutorial right now
because the PaperNet network configuration is so simple. Let’s turn our
attention to Balaji.</p>
</div>
<div class="section" id="digibank-applications">
<h2>Digibank applications<a class="headerlink" href="#digibank-applications" title="Permalink to this headline">¶</a></h2>
<p>Balaji uses DigiBank’s <code class="docutils literal notranslate"><span class="pre">buy</span></code> application to submit a transaction to the ledger
which transfers ownership of commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code> from MagnetoCorp to
DigiBank. The <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code> smart contract is the same as that used by
MagnetoCorp’s application, however the transaction is different this time –
it’s <code class="docutils literal notranslate"><span class="pre">buy</span></code> rather than <code class="docutils literal notranslate"><span class="pre">issue</span></code>. Let’s examine how DigiBank’s application works.</p>
<p>Open a separate terminal window for Balaji. In <code class="docutils literal notranslate"><span class="pre">fabric-samples</span></code>, change to the
DigiBank application directory that contains the application, <code class="docutils literal notranslate"><span class="pre">buy.js</span></code>, and open
it with your editor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(balaji)$ cd commercial-paper/organization/digibank/application/
(balaji)$ code buy.js
</pre></div>
</div>
<p>As you can see, this directory contains both the <code class="docutils literal notranslate"><span class="pre">buy</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem</span></code> applications
that will be used by Balaji.</p>
<p><img alt="../_images/commercial_paper.diagram.12.png" src="../_images/commercial_paper.diagram.12.png" />commercialpaper.vscode3 <em>DigiBank’s
commercial paper directory containing the <code class="docutils literal notranslate"><span class="pre">buy.js</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem.js</span></code>
applications.</em></p>
<p>DigiBank’s <code class="docutils literal notranslate"><span class="pre">buy.js</span></code> application is very similar in structure to MagnetoCorp’s
<code class="docutils literal notranslate"><span class="pre">issue.js</span></code> with two important differences:</p>
<ul>
<li><p class="first"><strong>Identity</strong>: the user is a DigiBank user <code class="docutils literal notranslate"><span class="pre">Balaji</span></code> rather than MagnetoCorp’s
<code class="docutils literal notranslate"><span class="pre">Isabella</span></code></p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">wallet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileSystemWallet</span><span class="p">(</span><span class="s1">&#39;../identity/user/balaji/wallet&#39;</span><span class="p">);</span><span class="sb">`</span>
</pre></div>
</div>
<p>See how the application uses the <code class="docutils literal notranslate"><span class="pre">balaji</span></code> wallet when it connects to the
PaperNet network channel. <code class="docutils literal notranslate"><span class="pre">buy.js</span></code> selects a particular identity within
<code class="docutils literal notranslate"><span class="pre">balaji</span></code> wallet.</p>
</li>
<li><p class="first"><strong>Transaction</strong>: the invoked transaction is <code class="docutils literal notranslate"><span class="pre">buy</span></code> rather than <code class="docutils literal notranslate"><span class="pre">issue</span></code></p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="sb">`const buyResponse = await contract.submitTransaction(&#39;buy&#39;, &#39;MagnetoCorp&#39;, &#39;00001&#39;...);`</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">buy</span></code> transaction is submitted with the values <code class="docutils literal notranslate"><span class="pre">MagnetoCorp</span></code>, <code class="docutils literal notranslate"><span class="pre">00001</span></code>…,
that are used by the <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code> smart contract class to transfer
ownership of commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code> to DigiBank.</p>
</li>
</ul>
<p>Feel free to examine other files in the <code class="docutils literal notranslate"><span class="pre">application</span></code> directory to understand
how the application works, and read in detail how <code class="docutils literal notranslate"><span class="pre">buy.js</span></code> is implemented in
the application <a class="reference external" href="../developapps/application.html">topic</a>.</p>
</div>
<div class="section" id="run-as-digibank">
<h2>Run as DigiBank<a class="headerlink" href="#run-as-digibank" title="Permalink to this headline">¶</a></h2>
<p>The DigiBank applications which buy and redeem commercial paper have a very
similar structure to MagnetoCorp’s issue application. Therefore, let’s install
their dependencies and set up Balaji’s wallet so that he can use these
applications to buy and redeem commercial paper.</p>
<p>Like MagnetoCorp, Digibank must the install the required application packages
using the <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code> command, and again, this make take a short time to
complete.</p>
<p>In the DigiBank administrator window, install the application dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(digibank admin)$ cd commercial-paper/organization/digibank/application/
(digibank admin)$ npm install

(            ) extract:lodash: sill extract ansi-styles@3.2.1
(...)
added 738 packages in 46.701s
</pre></div>
</div>
<p>In Balaji’s terminal window, run the <code class="docutils literal notranslate"><span class="pre">addToWallet.js</span></code> program to add identity
information to his wallet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(balaji)$ node addToWallet.js

done
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">addToWallet.js</span></code> program has added identity information for <code class="docutils literal notranslate"><span class="pre">balaji</span></code>, to his
wallet, which will be used by <code class="docutils literal notranslate"><span class="pre">buy.js</span></code> and <code class="docutils literal notranslate"><span class="pre">redeem.js</span></code> to submit transactions to
<code class="docutils literal notranslate"><span class="pre">PaperNet</span></code>.</p>
<p>Like Isabella, Balaji can store multiple identities in his wallet, though in our
example, he only uses one – <code class="docutils literal notranslate"><span class="pre">Admin&#64;org.example.com</span></code>. His corresponding wallet
structure <code class="docutils literal notranslate"><span class="pre">digibank/identity/user/balaji/wallet/Admin&#64;org1.example.com</span></code>
contains is very similar Isabella’s – feel free to examine it.</p>
</div>
<div class="section" id="buy-application">
<h2>Buy application<a class="headerlink" href="#buy-application" title="Permalink to this headline">¶</a></h2>
<p>Balaji can now use <code class="docutils literal notranslate"><span class="pre">buy.js</span></code> to submit a transaction that will transfer ownership
of MagnetoCorp commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code> to DigiBank.</p>
<p>Run the <code class="docutils literal notranslate"><span class="pre">buy</span></code> application in Balaji’s window:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(balaji)$ node buy.js

Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper buy transaction.
Process buy transaction response.
MagnetoCorp commercial paper : 00001 successfully purchased by DigiBank
Transaction complete.
Disconnect from Fabric gateway.
Buy program complete.
</pre></div>
</div>
<p>You can see the program output that MagnetoCorp commercial paper 00001 was
successfully purchased by Balaji on behalf of DigiBank. <code class="docutils literal notranslate"><span class="pre">buy.js</span></code> invoked the
<code class="docutils literal notranslate"><span class="pre">buy</span></code> transaction defined in the <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code> smart contract which updated
commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code> within the world state using the <code class="docutils literal notranslate"><span class="pre">putState()</span></code> and
<code class="docutils literal notranslate"><span class="pre">getState()</span></code> Fabric APIs. As you’ve seen, the application logic to buy and issue
commercial paper is very similar, as is the smart contract logic.</p>
</div>
<div class="section" id="redeem-application">
<h2>Redeem application<a class="headerlink" href="#redeem-application" title="Permalink to this headline">¶</a></h2>
<p>The final transaction in the lifecycle of commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code> is for
DigiBank to redeem it with MagnetoCorp. Balaji uses <code class="docutils literal notranslate"><span class="pre">redeem.js</span></code> to submit a
transaction to perform the redeem logic within the smart contract.</p>
<p>Run the <code class="docutils literal notranslate"><span class="pre">redeem</span></code> transaction in Balaji’s window:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(balaji)$ node redeem.js

Connect to Fabric gateway.
Use network channel: mychannel.
Use org.papernet.commercialpaper smart contract.
Submit commercial paper redeem transaction.
Process redeem transaction response.
MagnetoCorp commercial paper : 00001 successfully redeemed with MagnetoCorp
Transaction complete.
Disconnect from Fabric gateway.
Redeem program complete.
</pre></div>
</div>
<p>Again, see how the commercial paper 00001 was successfully redeemed when
<code class="docutils literal notranslate"><span class="pre">redeem.js</span></code> invoked the <code class="docutils literal notranslate"><span class="pre">redeem</span></code> transaction defined in <code class="docutils literal notranslate"><span class="pre">CommercialPaper</span></code>.
Again, it updated commercial paper <code class="docutils literal notranslate"><span class="pre">00001</span></code> within the world state to reflect
that the ownership returned to MagnetoCorp, the issuer of the paper.</p>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<p>To understand how applications and smart contracts shown in this tutorial work
in more detail, you’ll find it helpful to read
<a class="reference external" href="../developapps/developing_applications.html">Developing Applications</a>. This
topic will give you a fuller explanation of the commercial paper scenario, the
<code class="docutils literal notranslate"><span class="pre">PaperNet</span></code> business network, its actors, and how the applications and smart
contracts they use work in detail.</p>
<p>Also feel free to use this sample to start creating your own applications and
smart contracts!</p>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../build_network.html" class="btn btn-neutral float-right" title="Building Your First Network" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../write_first_app.html" class="btn btn-neutral" title="Writing Your First Application" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2019.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>