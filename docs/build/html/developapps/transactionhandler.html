

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Transaction handlers &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Endorsement policies" href="endorsementpolicies.html" />
    <link rel="prev" title="Transaction context" href="transactioncontext.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s new in v1.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_concepts.html">Key Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developing_applications.html">Developing Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="scenario.html">The scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html">Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Process and Data Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="smartcontract.html">Smart Contract Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="application.html">Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="apis.html">APIs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="designelements.html">Application design elements</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="contractname.html">Contract names</a></li>
<li class="toctree-l3"><a class="reference internal" href="chaincodenamespace.html">Chaincode namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="transactioncontext.html">Transaction context</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Transaction handlers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#types-of-handler">Types of handler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#defining-a-handler">Defining a handler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handler-processing">Handler processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-handlers">Multiple handlers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="endorsementpolicies.html">Endorsement policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectionprofile.html">Connection Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectionoptions.html">Connection Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="wallet.html">Wallet</a></li>
<li class="toctree-l3"><a class="reference internal" href="gateway.html">Gateway</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="developing_applications.html">Developing Applications</a> &raquo;</li>
        
          <li><a href="designelements.html">Application design elements</a> &raquo;</li>
        
      <li>Transaction handlers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developapps/transactionhandler.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="transaction-handlers">
<h1>Transaction handlers<a class="headerlink" href="#transaction-handlers" title="Permalink to this headline">¶</a></h1>
<p><strong>Audience</strong>: Architects, Application and smart contract developers</p>
<p>Transaction handlers allow smart contract developers to define common processing
at key points during the interaction between an application and a smart
contract. Transaction handlers are optional but, if defined, they will receive
control before or after every transaction in a smart contract is invoked. There
is also a specific handler which receives control when a request is made to
invoke a transaction not defined in a smart contract.</p>
<p>Here’s an example of transaction handlers for the <a class="reference external" href="./smartcontract.html">commercial paper smart
contract sample</a>:</p>
<p><img alt="../_images/develop.diagram.2.png" src="../_images/develop.diagram.2.png" />develop.transactionhandler</p>
<p><em>Before, After and Unknown transaction handlers. In this example,
<code class="docutils literal notranslate"><span class="pre">BeforeFunction()</span></code> is called before the <strong>issue</strong>, <strong>buy</strong> and <strong>redeem</strong>
transactions. <code class="docutils literal notranslate"><span class="pre">AfterFunction()</span></code> is called after the <strong>issue</strong>, <strong>buy</strong> and
<strong>redeem</strong> transactions. <code class="docutils literal notranslate"><span class="pre">UnknownFunction()</span></code> is only called if a request is made
to invoke a transaction not defined in the smart contract.  (The diagram is
simplified by not repeating <code class="docutils literal notranslate"><span class="pre">BeforeFunction</span></code> and <code class="docutils literal notranslate"><span class="pre">AfterFunction</span></code> boxes for each
transaction.</em></p>
<div class="section" id="types-of-handler">
<h2>Types of handler<a class="headerlink" href="#types-of-handler" title="Permalink to this headline">¶</a></h2>
<p>There are three types of transaction handlers which cover different aspects
of the interaction between an application and a smart contract:</p>
<ul class="simple">
<li><strong>Before handler</strong>: is called before every smart contract transaction is
invoked. The handler will usually modify the transaction context to be used
by the transaction. The handler has access to the full range of Fabric APIs;
for example, it can issue <code class="docutils literal notranslate"><span class="pre">getState()</span></code> and <code class="docutils literal notranslate"><span class="pre">putState()</span></code>.</li>
<li><strong>After handler</strong>: is called after every smart contract transaction is
invoked. The handler will usually perform post-processing common to all
transactions, and also has full access to the Fabric APIs.</li>
<li><strong>Unknown handler</strong>: is called if an attempt is made to invoke a transaction
that is not defined in a smart contract. Typically, the handler will record
the failure for subsequent processing by an administrator. The handler has
full access to the Fabric APIs.</li>
</ul>
</div>
<div class="section" id="defining-a-handler">
<h2>Defining a handler<a class="headerlink" href="#defining-a-handler" title="Permalink to this headline">¶</a></h2>
<p>Transaction handlers are added to the smart contract as methods with well
defined names.  Here’s an example which adds a handler of each type:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="nx">CommercialPaperContract</span> <span class="kr">extends</span> <span class="nx">Contract</span> <span class="p">{</span>

    <span class="p">...</span>

    <span class="nx">async</span> <span class="nx">beforeTransaction</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Write the transaction ID as an informational to the console</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stub</span><span class="p">.</span><span class="nx">getTxID</span><span class="p">());</span>
    <span class="p">};</span>

    <span class="nx">async</span> <span class="nx">afterTransaction</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This handler interacts with the ledger</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">stub</span><span class="p">.</span><span class="nx">cpList</span><span class="p">.</span><span class="nx">putState</span><span class="p">(...);</span>
    <span class="p">};</span>

    <span class="nx">async</span> <span class="nx">unknownTransaction</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This handler throws an exception</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Unknown transaction function&#39;</span><span class="p">);</span>
    <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The form of a transaction handler definition is the similar for all handler
types, but notice how the <code class="docutils literal notranslate"><span class="pre">afterTransaction(ctx,</span> <span class="pre">result)</span></code> also receives any
result returned by the transaction.</p>
</div>
<div class="section" id="handler-processing">
<h2>Handler processing<a class="headerlink" href="#handler-processing" title="Permalink to this headline">¶</a></h2>
<p>Once a handler has been added to the smart contract, it can be invoked during
transaction processing. During processing, the handler receives <code class="docutils literal notranslate"><span class="pre">ctx</span></code>, the
<a class="reference external" href="./transationcontext">transaction context</a>, performs some processing, and
returns control as it completes. Processing continues as follows:</p>
<ul class="simple">
<li><strong>Before handler</strong>: If the handler completes successfully, the transaction is
called with the updated context. If the handler throws an exception, then the
transaction is not called and the smart contract fails with the exception
error message.</li>
<li><strong>After handler</strong>: If the handler completes successfully, then the smart
contract completes as determined by the invoked transaction. If the handler
throws an exception, then the transaction fails with the exception error
message.</li>
<li><strong>Unknown handler</strong>: The handler should complete by throwing an exception with
the required error message. If an <strong>Unknown handler</strong> is not specified, or an
exception is not thrown by it, there is sensible default processing; the smart
contract will fail with an <strong>unknown transaction</strong> error message.</li>
</ul>
<p>If the handler requires access to the function and parameters, then it is easy to do this:</p>
<div class="highlight-JavaScript notranslate"><div class="highlight"><pre><span></span><span class="nx">async</span> <span class="nx">beforeTransaction</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Retrieve details of the transaction</span>
    <span class="kd">let</span> <span class="nx">txnDetails</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">stub</span><span class="p">.</span><span class="nx">getFunctionAndParameters</span><span class="p">();</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="sb">`Calling function: </span><span class="si">${</span><span class="nx">txnDetails</span><span class="p">.</span><span class="nx">fcn</span><span class="si">}</span><span class="sb"> `</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="sb">`Function arguments : %j </span><span class="si">${</span><span class="nx">stub</span><span class="p">.</span><span class="nx">getArgs</span><span class="p">()</span><span class="si">}</span><span class="sb"> ``);</span>
<span class="sb">}</span>
</pre></div>
</div>
</div>
<div class="section" id="multiple-handlers">
<h2>Multiple handlers<a class="headerlink" href="#multiple-handlers" title="Permalink to this headline">¶</a></h2>
<p>It is only possible to define at most one handler of each type for a smart
contract. If a smart contract needs to invoke multiple functions during before,
after or unknown handling, it should coordinate this from within the appropriate
function.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="endorsementpolicies.html" class="btn btn-neutral float-right" title="Endorsement policies" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="transactioncontext.html" class="btn btn-neutral" title="Transaction context" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2019.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>