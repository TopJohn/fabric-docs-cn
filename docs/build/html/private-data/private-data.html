

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Private data &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Ledger" href="../ledger/ledger.html" />
    <link rel="prev" title="Peers" href="../peers/peers.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="../index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=../_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="../_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="../_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="../_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="../_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whatis.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html">What’s new in v1.4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../key_concepts.html">Key Concepts</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../blockchain.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functionalities.html">Hyperledger Fabric Functionalities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fabric_model.html">Hyperledger Fabric Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/network.html">Blockchain network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../identity/identity.html">Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../membership/membership.html">Membership</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peers/peers.html">Peers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Private data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-private-data">What is private data?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-is-a-private-data-collection">What is a private data collection?</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#when-to-use-a-collection-within-a-channel-vs-a-separate-channel">When to use a collection within a channel vs. a separate channel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-use-case-to-explain-collections">A use case to explain collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transaction-flow-with-private-data">Transaction flow with private data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-a-private-data-collection-is-defined">How a private data collection is defined</a></li>
<li class="toctree-l3"><a class="reference internal" href="#purging-data">Purging data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ledger/ledger.html">Ledger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smartcontract/smartcontract.html">Smart Contracts and Chaincode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usecases.html">Use Cases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developapps/developing_applications.html">Developing Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ops_guide.html">Operations Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperledger-fabricdocs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../key_concepts.html">Key Concepts</a> &raquo;</li>
        
      <li>Private data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/private-data/private-data.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="private-data">
<h1>Private data<a class="headerlink" href="#private-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-private-data">
<h2>What is private data?<a class="headerlink" href="#what-is-private-data" title="Permalink to this headline">¶</a></h2>
<p>In cases where a group of organizations on a channel need to keep data private from
other organizations on that channel, they have the option to create a new channel
comprising just the organizations who need access to the data. However, creating
separate channels in each of these cases creates additional administrative overhead
(maintaining chaincode versions, policies, MSPs, etc), and doesn’t allow for use
cases in which you want all channel participants to see a transaction while keeping
a portion of the data private.</p>
<p>That’s why, starting in v1.2, Fabric offers the ability to create
<strong>private data collections</strong>, which allow a defined subset of organizations on a
channel the ability to endorse, commit, or query private data without having to
create a separate channel.</p>
</div>
<div class="section" id="what-is-a-private-data-collection">
<h2>What is a private data collection?<a class="headerlink" href="#what-is-a-private-data-collection" title="Permalink to this headline">¶</a></h2>
<p>A collection is the combination of two elements:</p>
<ol class="simple">
<li><strong>The actual private data</strong>, sent peer-to-peer <a class="reference external" href="../gossip.html">via gossip protocol</a>
to only the organization(s) authorized to see it. This data is stored in a
private database on the peer (sometimes called a “side” database, or
“SideDB”). The ordering service is not involved here and does not see the
private data. Note that setting up gossip requires setting up anchor peers
in order to bootstrap cross-organization communication.</li>
<li><strong>A hash of that data</strong>, which is endorsed, ordered, and written to the ledgers
of every peer on the channel. The hash serves as evidence of the transaction and
is used for state validation and can be used for audit purposes.</li>
</ol>
<p>The following diagram illustrates the ledger contents of a peer authorized to have
private data and one which is not.</p>
<p><img alt="../_images/PrivateDataConcept-2.png" src="../_images/PrivateDataConcept-2.png" />private-data.private-data</p>
<p>Collection members may decide to share the private data with other parties if they
get into a dispute or if they want to transfer the asset to a third party. The
third party can then compute the hash of the private data and see if it matches the
state on the channel ledger, proving that the state existed between the collection
members at a certain point in time.</p>
<div class="section" id="when-to-use-a-collection-within-a-channel-vs-a-separate-channel">
<h3>When to use a collection within a channel vs. a separate channel<a class="headerlink" href="#when-to-use-a-collection-within-a-channel-vs-a-separate-channel" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use <strong>channels</strong> when entire transactions (and ledgers) must be kept
confidential within a set of organizations that are members of the channel.</li>
<li>Use <strong>collections</strong> when transactions (and ledgers) must be shared among a set
of organizations, but when only a subset of those organizations should have
access to some (or all) of the data within a transaction.  Additionally,
since private data is disseminated peer-to-peer rather than via blocks,
use private data collections when transaction data must be kept confidential
from ordering service nodes.</li>
</ul>
</div>
</div>
<div class="section" id="a-use-case-to-explain-collections">
<h2>A use case to explain collections<a class="headerlink" href="#a-use-case-to-explain-collections" title="Permalink to this headline">¶</a></h2>
<p>Consider a group of five organizations on a channel who trade produce:</p>
<ul class="simple">
<li><strong>A Farmer</strong> selling his goods abroad</li>
<li><strong>A Distributor</strong> moving goods abroad</li>
<li><strong>A Shipper</strong> moving goods between parties</li>
<li><strong>A Wholesaler</strong> purchasing goods from distributors</li>
<li><strong>A Retailer</strong> purchasing goods from shippers and wholesalers</li>
</ul>
<p>The <strong>Distributor</strong> might want to make private transactions with the
<strong>Farmer</strong> and <strong>Shipper</strong> to keep the terms of the trades confidential from
the <strong>Wholesaler</strong> and the <strong>Retailer</strong> (so as not to expose the markup they’re
charging).</p>
<p>The <strong>Distributor</strong> may also want to have a separate private data relationship
with the <strong>Wholesaler</strong> because it charges them a lower price than it does the
<strong>Retailer</strong>.</p>
<p>The <strong>Wholesaler</strong> may also want to have a private data relationship with the
<strong>Retailer</strong> and the <strong>Shipper</strong>.</p>
<p>Rather than defining many small channels for each of these relationships, multiple
private data collections <strong>(PDC)</strong> can be defined to share private data between:</p>
<ol class="simple">
<li>PDC1: <strong>Distributor</strong>, <strong>Farmer</strong> and <strong>Shipper</strong></li>
<li>PDC2: <strong>Distributor</strong> and <strong>Wholesaler</strong></li>
<li>PDC3: <strong>Wholesaler</strong>, <strong>Retailer</strong> and <strong>Shipper</strong></li>
</ol>
<p><img alt="../_images/PrivateDataConcept-1.png" src="../_images/PrivateDataConcept-1.png" />private-data.private-data</p>
<p>Using this example, peers owned by the <strong>Distributor</strong> will have multiple private
databases inside their ledger which includes the private data from the
<strong>Distributor</strong>, <strong>Farmer</strong> and <strong>Shipper</strong> relationship and the
<strong>Distributor</strong> and <strong>Wholesaler</strong> relationship. Because these databases are kept
separate from the database that holds the channel ledger, private data is
sometimes referred to as “SideDB”.</p>
<p><img alt="../_images/PrivateDataConcept-3.png" src="../_images/PrivateDataConcept-3.png" />private-data.private-data</p>
</div>
<div class="section" id="transaction-flow-with-private-data">
<h2>Transaction flow with private data<a class="headerlink" href="#transaction-flow-with-private-data" title="Permalink to this headline">¶</a></h2>
<p>When private data collections are referenced in chaincode, the transaction flow
is slightly different in order to protect the confidentiality of the private
data as transactions are proposed, endorsed, and committed to the ledger.</p>
<p>For details on transaction flows that don’t use private data refer to our
documentation on <a class="reference external" href="../txflow.html">transaction flow</a>.</p>
<ol class="simple">
<li>The client application submits a proposal request to invoke a chaincode
function (reading or writing private data) to endorsing peers which are
part of authorized organizations of the collection. The private data, or
data used to generate private data in chaincode, is sent in a <code class="docutils literal notranslate"><span class="pre">transient</span></code>
field of the proposal.</li>
<li>The endorsing peers simulate the transaction and store the private data in
a <code class="docutils literal notranslate"><span class="pre">transient</span> <span class="pre">data</span> <span class="pre">store</span></code> (a temporary storage local to the peer). They
distribute the private data, based on the collection policy, to authorized peers
via <a class="reference external" href="../gossip.html">gossip</a>.</li>
<li>The endorsing peer sends the proposal response back to the client with public
data, including a hash of the private data key and value. <em>No private data is
sent back to the client</em>. For more information on how endorsement works with
private data, click <a class="reference external" href="../private-data-arch.html#endorsement">here</a>.</li>
<li>The client application submits the transaction to the ordering service (with
hashes of the private data) which gets distributed into blocks as normal.
The block with the hashed values is distributed to all the peers. In this way,
all peers on the channel can validate transactions with the hashes of the private
data in a consistent way, without knowing the actual private data.</li>
<li>At block-committal time, authorized peers use the collection policy to
determine if they are authorized to have access to the private data. If they do,
they will first check their local <code class="docutils literal notranslate"><span class="pre">transient</span> <span class="pre">data</span> <span class="pre">store</span></code> to determine if they
have already received the private data at chaincode endorsement time. If not,
they will attempt to pull the private data from another peer. Then they will
validate the private data against the hashes in the public block and commit the
transaction and the block. Upon validation/commit, the private data is moved to
their copy of the private state database and private writeset storage. The
private data is then deleted from the <code class="docutils literal notranslate"><span class="pre">transient</span> <span class="pre">data</span> <span class="pre">store</span></code>.</li>
</ol>
</div>
<div class="section" id="how-a-private-data-collection-is-defined">
<h2>How a private data collection is defined<a class="headerlink" href="#how-a-private-data-collection-is-defined" title="Permalink to this headline">¶</a></h2>
<p>For more details on collection definitions, and other low level information about
private data and collections, refer to the <a class="reference external" href="../private-data-arch.html">private data reference topic</a>.</p>
</div>
<div class="section" id="purging-data">
<h2>Purging data<a class="headerlink" href="#purging-data" title="Permalink to this headline">¶</a></h2>
<p>For very sensitive data, even the parties sharing the private data might want
— or might be required by government regulations — to “purge” the data stored
on their peers after a set amount of time, leaving behind only a hash of the data
to serve as immutable evidence of the transaction.</p>
<p>In some of these cases, the private data only needs to exist on the peer’s private
database until it can be replicated into a database external to the blockchain
network. The data might also only need to exist on the peers until a chaincode business
process is done with it (trade settled, contract fulfilled, etc). To support the later
use case, it is possible to purge private data if it has not been modified once a set
number of subsequent blocks have been added to the private database.</p>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ledger/ledger.html" class="btn btn-neutral float-right" title="Ledger" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../peers/peers.html" class="btn btn-neutral" title="Peers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2019.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>